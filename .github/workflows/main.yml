name: "Test"

on:
  push: {}
  workflow_dispatch:
    inputs:
      test_input:
        description: "blah"
        required: true
        default: "abc,def,ghi"

jobs:
  split-input:
    runs-on: ubuntu-latest
    steps:
      - id: split
        shell: bash
        run: |
          printenv
          # TEST_INPUT=${{ inputs.test_input }}
          # DEFAULT=${{ on.workflow_call.inputs.test_input.default }}
          # TEST_INPUT=${TEST_INPUT:-$DEFAULT}
          # echo "scopes=`echo ${TEST_INPUT} | jq -Rc 'split(",")'`" >> $GITHUB_OUTPUT
          # echo $GITHUB_OUTPUT
    outputs:
      scopes: ${{ steps.split.outputs.scopes }}
  test-job:
    needs: split-input
    runs-on: ubuntu-latest
    strategy:
      max-parallel: 1
      matrix:
        scope: ${{ fromJSON(needs.split-input.outputs.scopes) }}
    name: "${{ matrix.scope }}"
    steps:
      - shell: bash
        run: |
          echo ${{ matrix.scope }}
